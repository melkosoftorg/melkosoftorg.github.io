<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>ОП | Лекция № 47</title>
<link rel=stylesheet type=text/css href=../../../css/lec.css>
</head>
<body>
<a name=#start></a>
<table class=pages align=center border=0 cellpadding=0 cellspacing=0>
<tr colspan=5>
<td>&nbsp&nbsp<a href="../../../plan_2.htm" class=p>Календарно-тематический план</a>&nbsp&nbsp</td>
<td><a href="index.htm" class=p>&nbsp План лекции &nbsp</a></td>
</tr>
</table>
<!-- -------Inside table------- -->
<table width=98% border=0 cellpadding=5 cellspacing=0>
<tr><td class=usual><p align=center class=dbi><br>Интерфейс с DOS</p>
<p><b><center>dos.h</center></b>
<p><center><table width="90%" border=1 cellpadding=5>
<tr><td><b><center>Имя</center></b></td><td><b><center>Назначение</center></b></td></tr>
<tr><td><a href="#01">setcbrk</a></td><td>устанавливает control-break.</td></tr>
<tr><td><a href="#02">setvect</a></td><td>устанавливает содержимое вектора прерывания</td></tr>
<tr><td><a href="#03">_version</a></td><td>содержит номер версии DOS</td></tr>
<tr><td><a href="#03">_osmajor</a></td><td>содержит старший номер версии DOS</td></tr>
<tr><td><a href="#03">_osminor</a></td><td>содержит младший номер версии DOS</td></tr>
<tr><td><a href="#04">bdos</a></td><td>вызов системы MS-DOS</td></tr>
<tr><td><a href="#04">bdosptr</a></td><td>системный вызов MS-DOS</td></tr>
<tr><td><a href="#05">MK_FP</a></td><td>создает "дальний" адресный указатель</td></tr>
<tr><td><a href="#05">FP_OFF</a></td><td>получает смещение "дальнего" адреса адреса с атрибутом far</td></tr>
<tr><td><a href="#05">FP_SEG</a></td><td>получает адрес сегмента с атрибутом "far" (дальний)</td></tr>
</table></center>
<p><center><b>Прерывания</b></center></p>
<p><center><table width="90%" border=1 cellpadding=5>
<tr><td><b><center>Имя</center></b></td><td><b><center>Назначение</center></b></td></tr>
<tr><td><a href="incl_04.htm#01">int86</a></td><td>выполняет прерывания от математического обеспечения микропроцессора 8086</td></tr>
<tr><td><a href="incl_04.htm#01">int86x</a></td><td>поддерживает прерывания математического обеспечения микропроцессора 8086</td></tr>
<tr><td><a href="incl_04.htm#02">intdos</a></td><td>поддерживает прерывания MS-DOS</td></tr>
<tr><td><a href="incl_04.htm#02">intdosx</a></td><td>поддерживает прерывания MS-DOS</td></tr>
<tr><td><a href="incl_04.htm#03">intr</a></td><td>поддерживает альтернативный интерфейс для выполнения прерываний математического обеспечения микропроцессора 8086</td></tr>
<tr><td><a href="incl_04.htm#04">getvect</a></td><td>получает содержимое вектора прерывания</td></tr>
<tr><td><a href="incl_04.htm#05">disable</a></td><td>делает прерывания невозможными</td></tr>
<tr><td><a href="incl_04.htm#05">enable</a></td><td>разрешает прерывания</td></tr>
<tr><td><a href="incl_04.htm#05">geninterrupt</a></td><td>генерирует прерывание программного обеспечения</td></tr>
<tr><td><a href="incl_04.htm#06">getcbrk</a></td><td>получает параметры контроля над прерываниями</td></tr>
<tr><td><a href="incl_04.htm#07">segread</a></td><td>считывает значения сегментных регистров</td></tr>
<tr><td><a href="incl_04.htm#08">getpsp</a></td><td>получает адрес префикса программного сегмента</td></tr>
<tr><td><a href="incl_04.htm#09">environ</a></td><td>массив из символьных строк</td></tr>
</table></center>
<p><center><b>Работа с диском</b></center></p>
<p><center><table width="90%" border=1 cellpadding=5>
<tr><td><b><center>Имя</center></b></td><td><b><center>Назначение</center></b></td></tr>
<tr><td><a href="incl_04.htm#10">absread</a></td><td>читает данные</td></tr>
<tr><td><a href="incl_04.htm#10">abswrite</a></td><td>записывает данные </td></tr>
<tr><td><a href="incl_04.htm#11">randbrd</a></td><td>читает блок произвольной длины</td></tr>
<tr><td><a href="incl_04.htm#11">randbwr</a></td><td>записывает на диск произвольный блок</td></tr>
<tr><td><a href="incl_04.htm#12">getdta</a></td><td>получает адрес DTA (рабочего буфера обмена с диском)</td></tr>
<tr><td><a href="incl_04.htm#12">setdta</a></td><td>устанавливает адрес DTA</td></tr>
</table></center>
<p> &nbsp; </p><a name="01"></a>
<p><b><i>setcbrk</i></b> - устанавливает control-break. 
<br><b><i>Синтаксис</i></b>	int setcbrk(int value);
<p>setcbrk использует системный вызов MS-DOS 0x33 для установки параметров контроля над прерываниями (ON или OFF).
<ul><li>value = 0 - проверка выключена (off), прерывания разрешены только для операций ввода/вывода с консоли, принтера или устройств коммуникаций.
<li>value = 1 - проверка включена (on), прерывания обрабатываются любые.</ul>
<p>setcbrk возвращает значение value.
<p> &nbsp; </p><a name="02"></a>
<p><b><i>setvect</i></b> - устанавливает содержимое вектора прерывания.
<br><b><i>Синтаксис</i></b>	void setvect(int intr_num, void interrupt(*isr)());
<p>Операционная система MS-DOS содержит набор векторов прерываний от электронного обеспечения, пронумерованных от 0 до 255. 4-х байтовое значение каждого вектора есть действительный адрес, по которому расположена функция прерывания.
<br>setvect присваивает вектору с именем intr_num новое значение vector, которое является "дальним" указателем, содержащим адрес новой функции прерывания. Адрес подпрограммы на языке C может быть 
передан параметру vector только в том случае, если эта подпрограмма объявлена с типом interrupt.
<br>setvect не возвращает никакого значения.
<p> &nbsp; </p><a name="03"></a>
<p><b><i>_version</i></b> - содержит номер версии DOS 
<br><b><i>_osmajor</i></b> - содержит старший номер версии DOS
<br><b><i>_osminor</i></b> - содержит младший номер версии DOS
<p><b><i>Синтаксис</i></b>	extern unsigned int _version;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extern unsigned char _osmajor;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extern unsigned char _osminor;
<p>_version для версии операционной системы MS-DOS, представляемой в виде X. Y - старший номер версии X расположен в младших байтах, а младший номер версии Y - в старших байтах (X - номер версии, Y - расширение номера версии).
<br>_osmajor содержит номер версии, <br>_osminor содержит расширение.
<p> &nbsp; </p><a name="04"></a>
<p><b><i>bdos</i></b> - вызов системы MS-DOS
<br><b><i>bdosptr</i></b> - системный вызов MS-DOS
<p><b><i>Синтаксис</i></b>	int bdos(int dosfun, unsigned dosdx, unsigned dosal);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int bdosprt(int dosfun, void * argument, unsigned dosal);
<p>Применение функции обеспечивает прямой доступ ко многим системным вызовам MS-DOS.
<br>Описания каждого системного вызова и параметра dosfun можно найти в документе "Справочное руководство программиста MS-DOS". 
<br>Системные вызовы, требующие целый аргумент, используют функцию bdos, те вызовы, аргументом которых является адресный указатель, используют функцию bdosptr.
<br>Для малых моделей данных (сверхмалых, малых, средних) функции bdos и bdosptr очень похожи.
<br>В крупных моделях данных (компактных, больших, сверхбольших) предпочтительнее использовать для системных вызовов функцию bdosptr с адресным указателем в качестве агрумента.
<br>В малых моделях данных параметр argument в функции bdosptr специфицирует регистр DX; в крупных моделях данных этот аргумент дает значения регистров DS:DX, которые будут использоваться при системных вызовах.
<br>Параметр dosdx - значение регистра DX при вызове функции bdos.
<br>Параметр dosal - значение регистра AL.
<br>bdos возвращает значение регистра AX, получаемое при системном вызове.
<br>bdosptr возвращает значение регистра AX при успешном завершении и значение -1 при неудачном завершении. 
<br>При неудачном завершении глобальные переменные errno и _doserrno получают значения.
<p> &nbsp; </p><a name="05"></a>
<p><b><i>MK_FP</i></b> - создает "дальний" адресный указатель
<br><b><i>FP_OFF</i></b> - получает смещение "дальнего" адреса адреса с атрибутом " far " 
<br><b><i>FP_SEG</i></b> - получает адрес сегмента с атрибутом "far" (дальний). 
<p><b><i>Синтаксис</i></b>	far *MK_FP(unsigned seg, unsigned off);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; insigned FP_OFF(void far * farptr);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FP_SEG(void far * farptr); 
<p>Макрокоманда FP_OFF используется для получения адресного смещения указателя с атрибутом " far " farptr.
<br>Макрокоманда FP_SEG используется для установки значения адреса сегмента для адресного указателя с атрибутом " far " farptr.
<br>MK_FP макрокоманда, которая составляет адресный указатель с атрибутом " far " из компонентов адреса сегмента (seg) и смещения (off).
<br>FP_OFF возвращает целое число без знака, представляющее собой значение адресного смещения.
<br>FP_SEG возвращает целое число без знака, представляющее собой значение адреса сегмента.
<br>MK_FP возвращает адресный указатель с атрибутом "far".
<p> &nbsp; </p>
</td></tr>
</table>
<!-- -------End of Inside table------- -->
<table class=pages align=center border=0 cellpadding=0 cellspacing=0>
<tr colspan=5>
<td>&nbsp&nbsp<a href="../../../plan_2.htm" class=p>Календарно-тематический план</a>&nbsp&nbsp</td>
<td><a href="index.htm" class=p>&nbsp План лекции &nbsp</a></td>
</tr>
</table>
<a name=#end></a>
</body>
</html>